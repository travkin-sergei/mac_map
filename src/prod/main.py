import time

from src.prod.site.class_site import MacMap
from src.prod.site.orm import updateCountry, updateProducts, ormCreateTable

ddd = [
    "004", "008", "012", "024", "028", "031", "032", "036", "040", "044", "048", "050", "051", "052", "056", "060",
    "064", "068", "070", "072", "076", "084", "090", "096", "100", "104", "108", "112", "116", "120", "124", "132",
    "136", "140", "144", "148", "152", "156", "170", "174", "175", "178", "180", "184", "188", "191", "192", "196",
    "203", "204", "208", "212", "214", "218", "222", "226", "231", "233", "242", "246", "251", "258", "262", "266",
    "268", "270", "275", "276", "288", "292", "296", "300", "308", "320", "324", "328", "332", "340", "344", "348",
    "352", "360", "364", "372", "376", "381", "384", "388", "392", "398", "400", "404", "410", "414", "417", "418",
    "422", "426", "428", "430", "434", "438", "440", "442", "446", "450", "454", "458", "462", "466", "470", "478",
    "480", "484", "490", "496", "498", "499", "500", "504", "508", "512", "516", "520", "524", "528", "530", "533",
    "548", "554", "558", "562", "566", "579", "583", "585", "586", "591", "598", "600", "604", "608", "616", "620",
    "624", "626", "634", "642", "643", "646", "659", "660", "662", "666", "670", "678", "682", "686", "688", "690",
    "694", "699", "702", "703", "704", "705", "706", "710", "716", "724", "728", "736", "740", "748", "752", "757",
    "760", "762", "764", "768", "776", "780", "784", "788", "792", "798", "800", "804", "807", "818", "826", "834",
    "842", "854", "858", "860", "862", "876", "882", "887", "894", "895",
]


def main():
    ormCreateTable()

    # updating directories
    countries = MacMap().countries()

    print('start')
    if countries:
        for i_data in countries:
            updateCountry(i_data)
    country_list = [i['Code'] for i in countries]
    sorted(country_list)
    for i_country in country_list:
        if i_country not in ddd:
            print(f'i_country={i_country}')
            products = MacMap().products(i_country)
            time.sleep(5)
            if products:
                for i_data in products:
                    updateProducts(i_data, i_country)


# Все что ниже удалить если включать в Airflow
if __name__ == '__main__':
    main()
else:
    raise SystemExit("Это не библиотека")
